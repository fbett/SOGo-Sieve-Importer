# SOGo-Sieve-Importer

SOGO Sieve Importer written in PHP using ROUNDCUBE's `rcube_sieve_script`.

## Introduction

While a SOGo migration there was the requirement to migrate sieve rules (generated by ROUNDCUBE), 
but there is not a default way to do this.

There is a great script at [wixaw/sieve_to_sogo-import](https://github.com/wixaw/sieve_to_sogo-import),
but we ran into syntax problems - mainly because this script is parsing using REGEX not by specification - and the sieve rules generated by ROUNDCUBE are surrounded by unsupported curly braces.

As we know, the ROUNDCUBE's "managesieve" plugin does a great job on parsing and writing sieve rules.

So we merged these two scripts:
- ROUNDCUBE's `rcube_sieve_script` should parse the existing rules
- [wixaw/sieve_to_sogo-import](https://github.com/wixaw/sieve_to_sogo-import) inspired the transformation

Out of any warrenty we share our script here to you.

## Prerequisites

- The minimum required PHP version is 7.3.
- Place a copy of ROUNDCUBE's `rcube_sieve_script` in the root folder from [their repository](https://github.com/roundcube/roundcubemail/blob/master/plugins/managesieve/lib/Roundcube/rcube_sieve_script.php)
- Set the SOGo credentials to the "credentials" file (could be a master user or the user you have to import the sieve rules for)
- Console command `sogo-tool` must be available (it is included by default when installing SOGo on Debian)

## Usuage

`php import.php /path/to/existing-sieve-file.sieve target-user`

The `sogo-tool` response is pretty good: 
If there are any problems the response should be very clear and 
the import will be aborted without writing something to the SOGo system.

## Known Issues

- Not all sieve rules and tests are implemented
- Some roundcube's tests are not supported by SOGo (i'm not sure, we replaced the test "subject contains 'text'" by a REGEX test).
- The [wixaw/sieve_to_sogo-import](https://github.com/wixaw/sieve_to_sogo-import) is supporting general vacation and forward settings, we don't do this: we used forward/redirect rules instead and they will be migrated using this script.
- After importing it is still necessary to log in the SOGo web app, go to "Settings" -> "E-Mail" -> "Filter", to confirm the warning to overwrite existing sieve rules and to save the rules to the mail system
- Some users had the problem, that their rules were not active: Mails were not moved to a specific folder. The problem was the imap folder delimiter `/` instead of `.`. Solution: Change a rule and save. All rules should be rewritten using the correct delimiter. We did not set an imap folder delimiter in the SOGo's config file, so we don't know why this happend - if you know why, please open a new issue.

## License

This project is licensed under the MIT License - see the [LICENSE.md](LICENSE.md) file for details.